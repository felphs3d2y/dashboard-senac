<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Senac - Analytics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .dashboard-container {
            display: flex;
            width: 100%;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1);
        }

        .sidebar-header {
            padding: 25px;
            border-bottom: 1px solid #333;
        }

        .sidebar-logo {
            color: #ea820b;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .sidebar-search {
            display: flex;
            align-items: center;
            background: linear-gradient(90deg, #333 0%, #404040 100%);
            padding: 12px;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .sidebar-search:hover {
            background: linear-gradient(90deg, #404040 0%, #555 100%);
        }

        .sidebar-search input {
            border: none;
            background: transparent;
            color: white;
            margin-left: 10px;
            outline: none;
            width: 100%;
        }

        .sidebar-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav li {
            margin: 5px 0;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            color: white;
            padding: 18px 25px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .sidebar-nav a i {
            margin-right: 15px;
            width: 20px;
            transition: transform 0.3s ease;
        }

        .sidebar-nav .ativado,
        .sidebar-nav a:hover {
            background: linear-gradient(90deg, #ea820b 0%, #ff9533 100%);
            color: #fff !important;
            transform: translateX(10px);
        }

        .sidebar-nav .ativado i,
        .sidebar-nav a:hover i {
            transform: scale(1.2);
        }

        .sidebar-footer {
            padding: 25px;
            text-align: center;
            border-top: 1px solid #333;
        }

        .sidebar-footer a {
            color: #ea820b;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .sidebar-footer a:hover {
            color: #ff9533;
        }

        .main-content {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            padding: 0;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, #fff 0%, #f8f9fa 100%);
            padding: 20px 30px;
            border-bottom: 1px solid #e0e0e0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .linha {
            font-weight: bold;
            color: #333;
            font-size: 18px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 3px solid #ea820b;
        }

        .main-section {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s ease-in-out;
        }

        .main-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h2 {
            color: #ea820b;
            margin-bottom: 25px;
            font-size: 28px;
            font-weight: 600;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #ea820b;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ea820b;
        }

        .btn {
            background: linear-gradient(90deg, #ea820b 0%, #ff9533 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(234, 130, 11, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(90deg, #6c757d 0%, #545b62 100%);
        }

        .companies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .company-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #ea820b;
        }

        .company-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .company-name {
            font-size: 18px;
            font-weight: bold;
            color: #ea820b;
            margin-bottom: 10px;
        }

        .company-info {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        #faturamentoChart{
            height: 300px;
            width: 100%;
            max-height: 400px;
        }

        #setorChart{
             height: 300px;
            width: 100%;
            max-height: 400px;
        }
        
        #scatterChart{
            height: 300px;
            width: 100%;
            max-height: 400px;
        }

        #lineChart{
             height: 300px;
            width: 100%;
            max-height: 400px;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .chart-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #ea820b;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .delete-btn {
            background: linear-gradient(90deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .no-data {
            text-align: center;
            color: #666;
            padding: 50px;
            font-size: 18px;
        }

        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div>
                <div class="sidebar-header">
                    <div class="sidebar-logo">
                        <i class="fas fa-chart-line"></i> SENAC ANALYTICS
                    </div>
                    <div class="sidebar-search">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Pesquisar...">
                    </div>
                </div>
                <nav class="sidebar-nav">
                    <ul>
                        <li class="nav-item ativado">
                            <a href="#" data-target="content-login">
                                <i class="fa-solid fa-home"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" data-target="content-empresas">
                                <i class="fas fa-building"></i> Empresas
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" data-target="content-crm">
                                <i class="fa-solid fa-chart-bar"></i> Analytics CRM
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="sidebar-footer">
                <a href="#"><i class="fas fa-sign-out-alt"></i> SAIR</a>
            </div>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <div class="linha">ANALYTICS EMPRESARIAL SENAC</div>
                <div class="user-info">
                    <div class="user-name" style="color: #ea820b; font-weight: bold;">Senac Analytics</div>
                    <img src="https://via.placeholder.com/45/ea820b/white?text=SA" alt="logo" class="user-avatar">
                    <i class="fas fa-ellipsis-v" style="color: #ea820b; cursor: pointer;"></i>
                </div>
            </header>

            <!-- Dashboard Principal -->
            <section id="content-login" class="main-section active">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard Principal</h2>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalEmpresas">0</div>
                        <div class="stat-label">Empresas Cadastradas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="faturamentoTotal">R$ 0</div>
                        <div class="stat-label">Faturamento Total</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="mediaFuncionarios">0</div>
                        <div class="stat-label">Média de Funcionários</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="ticketMedio">R$ 0</div>
                        <div class="stat-label">Ticket Médio</div>
                    </div>
                </div>

                <div class="card">
                    <h3>Bem-vindo ao Sistema de Analytics Empresarial</h3>
                    <p>Este dashboard oferece análises profundas sobre o desempenho das empresas cadastradas. Utilize as
                        funcionalidades para:</p>
                    <ul>
                        <li><strong>Cadastrar Empresas:</strong> Adicione informações detalhadas sobre cada empresa</li>
                        <li><strong>Análises CRM:</strong> Visualize gráficos e métricas de performance</li>
                        <li><strong>Insights Estratégicos:</strong> Tome decisões baseadas em dados</li>
                    </ul>
                </div>
            </section>

            <!-- Gestão de Empresas -->
            <section id="content-empresas" class="main-section">
                <h2><i class="fas fa-building"></i> Gestão de Empresas</h2>

                <div class="card">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>Empresas Cadastradas</h3>
                        <button class="btn" onclick="openModal()">
                            <i class="fas fa-plus"></i> Nova Empresa
                        </button>
                    </div>

                    <div id="companiesContainer" class="companies-grid">
                        <div class="no-data">
                            <i class="fas fa-building" style="font-size: 48px; color: #ccc; margin-bottom: 20px;"></i>
                            <p>Nenhuma empresa cadastrada ainda.<br>Clique em "Nova Empresa" para começar.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CRM Analytics -->
            <section id="content-crm" class="main-section">
                <h2><i class="fas fa-chart-bar"></i> Analytics & CRM</h2>

                <div class="filter-section">
                    <h3>Filtros de Análise</h3>
                    <div class="filter-row">
                        <div class="form-group">
                            <label>Período</label>
                            <select id="periodoFilter">
                                <option value="todos">Todos os períodos</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Setor</label>
                            <select id="setorFilter">
                                <option value="todos">Todos os setores</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Porte</label>
                            <select id="porteFilter">
                                <option value="todos">Todos os portes</option>
                                <option value="pequeno">Pequeno</option>
                                <option value="medio">Médio</option>
                                <option value="grande">Grande</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button class="btn" onclick="updateCharts()">
                                <i class="fas fa-filter"></i> Aplicar Filtros
                            </button>
                        </div>
                    </div>
                </div>

                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">Faturamento por Empresa</div>
                        <canvas id="faturamentoChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">Distribuição por Setor</div>
                        <canvas id="setorChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">Funcionários vs Faturamento</div>
                        <canvas id="scatterChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">Evolução Temporal</div>
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal para cadastro de empresa -->
    <div id="companyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Cadastrar Nova Empresa</h2>
            <form id="companyForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nome da Empresa *</label>
                        <input type="text" id="nomeEmpresa" required>
                    </div>
                    <div class="form-group">
                        <label>CNPJ *</label>
                        <input type="text" id="cnpj" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Setor *</label>
                        <select id="setor" required>
                            <option value="">Selecione</option>
                            <option value="Tecnologia">Tecnologia</option>
                            <option value="Varejo">Varejo</option>
                            <option value="Serviços">Serviços</option>
                            <option value="Indústria">Indústria</option>
                            <option value="Saúde">Saúde</option>
                            <option value="Educação">Educação</option>
                            <option value="Financeiro">Financeiro</option>
                            <option value="Alimentício">Alimentício</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Porte da Empresa *</label>
                        <select id="porte" required>
                            <option value="">Selecione</option>
                            <option value="pequeno">Pequeno (até 50 funcionários)</option>
                            <option value="medio">Médio (51-200 funcionários)</option>
                            <option value="grande">Grande (200+ funcionários)</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Faturamento Mensal (R$) *</label>
                        <input type="number" id="faturamento" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Número de Funcionários *</label>
                        <input type="number" id="funcionarios" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Cidade *</label>
                        <input type="text" id="cidade" required>
                    </div>
                    <div class="form-group">
                        <label>Estado *</label>
                        <select id="estado" required>
                            <option value="">Selecione</option>
                            <option value="SP">São Paulo</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="PR">Paraná</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="MA">Maranhão</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Ano de Fundação *</label>
                        <input type="number" id="anoFundacao" min="1900" max="2024" required>
                    </div>
                    <div class="form-group">
                        <label>Ticket Médio (R$)</label>
                        <input type="number" id="ticketMedio" step="0.01">
                    </div>
                </div>

                <div class="form-group">
                    <label>Email de Contato</label>
                    <input type="email" id="email">
                </div>

                <div class="form-group">
                    <label>Observações</label>
                    <textarea id="observacoes" rows="3"></textarea>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> Cadastrar Empresa
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>
    <script>
        // Dados das empresas
        let empresas = [];
        let charts = {};

        // Navegação
        const navLinks = document.querySelectorAll('.sidebar-nav a');
        const sections = document.querySelectorAll('.main-section');

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('data-target');

                sections.forEach(section => {
                    section.classList.remove('active');
                });

                document.getElementById(targetId).classList.add('active');

                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('ativado');
                });
                link.parentElement.classList.add('ativado');

                // Atualizar gráficos quando abrir CRM
                if (targetId === 'content-crm') {
                    setTimeout(() => updateCharts(), 100);
                }
            });
        });

        // Modal functions
        function openModal() {
            document.getElementById('companyModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('companyModal').style.display = 'none';
            document.getElementById('companyForm').reset();
        }

        // Cadastro de empresa
        document.getElementById('companyForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const nomeEmpresa = document.getElementById('nomeEmpresa').value;
            const cnpj = document.getElementById('cnpj').value;
            const setor = document.getElementById('setor').value;
            const porte = document.getElementById('porte').value;
            const faturamento = document.getElementById('faturamento').value;
            const funcionarios = document.getElementById('funcionarios').value;
            const cidade = document.getElementById('cidade').value;
            const estado = document.getElementById('estado').value;
            const anoFundacao = document.getElementById('anoFundacao').value;

            if (!nomeEmpresa || !cnpj || !setor || !porte || !faturamento || !funcionarios || !cidade || !estado || !anoFundacao) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }

            if (isNaN(faturamento) || parseFloat(faturamento) <= 0) {
                alert('Por favor, insira um valor válido para o faturamento.');
                return;
            }

            if (isNaN(funcionarios) || parseInt(funcionarios) <= 0) {
                alert('Por favor, insira um valor válido para o número de funcionários.');
                return;
            }

            if (isNaN(anoFundacao) || parseInt(anoFundacao) < 1900 || parseInt(anoFundacao) > new Date().getFullYear()) {
                alert('Por favor, insira um ano de fundação válido.');
                return;
            }

            const empresa = {
                id: Date.now(),
                nome: nomeEmpresa,
                cnpj: cnpj,
                setor: setor,
                porte: porte,
                faturamento: parseFloat(faturamento),
                funcionarios: parseInt(funcionarios),
                cidade: cidade,
                estado: estado,
                anoFundacao: parseInt(anoFundacao),
                ticketMedio: parseFloat(document.getElementById('ticketMedio').value) || 0,
                email: document.getElementById('email').value,
                observacoes: document.getElementById('observacoes').value,
                dataCadastro: new Date().toISOString()
            };

            empresas.push(empresa);
            displayCompanies();
            updateDashboard();
            closeModal();

            alert('Empresa cadastrada com sucesso!');
        });

        // Exibir empresas
        function displayCompanies() {
            const container = document.getElementById('companiesContainer');

            if (empresas.length === 0) {
                container.innerHTML = `
            <div class="no-data">
                <i class="fas fa-building" style="font-size: 48px; color: #ccc; margin-bottom: 20px;"></i>
                <p>Nenhuma empresa cadastrada ainda.<br>Clique em "Nova Empresa" para começar.</p>
            </div>
        `;
                return;
            }

            container.innerHTML = empresas.map(empresa => `
        <div class="company-card">
            <div class="company-name">${empresa.nome}</div>
            <div class="company-info"><strong>CNPJ:</strong> ${empresa.cnpj}</div>
            <div class="company-info"><strong>Setor:</strong> ${empresa.setor}</div>
            <div class="company-info"><strong>Porte:</strong> ${empresa.porte}</div>
            <div class="company-info"><strong>Faturamento:</strong> R$ ${empresa.faturamento.toLocaleString('pt-BR')}</div>
            <div class="company-info"><strong>Funcionários:</strong> ${empresa.funcionarios}</div>
            <div class="company-info"><strong>Localização:</strong> ${empresa.cidade}/${empresa.estado}</div>
            <div style="margin-top: 15px;">
                <button class="delete-btn" onclick="deleteCompany(${empresa.id})">
                    <i class="fas fa-trash"></i> Excluir
                </button>
            </div>
        </div>
    `).join('');
        }

        // Excluir empresa
        function deleteCompany(id) {
            if (confirm('Tem certeza que deseja excluir esta empresa?')) {
                empresas = empresas.filter(e => e.id !== id);
                displayCompanies();
                updateDashboard();
            }
        }

        // Atualizar dashboard
        function updateDashboard() {
            const totalEmpresas = empresas.length;
            const faturamentoTotal = empresas.reduce((sum, e) => sum + e.faturamento, 0);
            const mediaFuncionarios = totalEmpresas > 0 ? Math.round(empresas.reduce((sum, e) => sum + e.funcionarios, 0) / totalEmpresas) : 0;
            const ticketMedio = totalEmpresas > 0 ? empresas.reduce((sum, e) => sum + e.ticketMedio, 0) / totalEmpresas : 0;

            document.getElementById('totalEmpresas').textContent = totalEmpresas;
            document.getElementById('faturamentoTotal').textContent = `R$ ${faturamentoTotal.toLocaleString('pt-BR')}`;
            document.getElementById('mediaFuncionarios').textContent = mediaFuncionarios;
            document.getElementById('ticketMedio').textContent = `R$ ${ticketMedio.toLocaleString('pt-BR')}`;

            // Atualizar filtros
            updateFilters();
        }

        // Atualizar filtros
        function updateFilters() {
            const setorFilter = document.getElementById('setorFilter');
            const setores = [...new Set(empresas.map(e => e.setor))];

            setorFilter.innerHTML = '<option value="todos">Todos os setores</option>';
            setores.forEach(setor => {
                setorFilter.innerHTML += `<option value="${setor}">${setor}</option>`;
            });
        }

        // Atualizar gráficos
        function updateCharts() {
            const periodoFilter = document.getElementById('periodoFilter').value;
            const setorFilter = document.getElementById('setorFilter').value;
            const porteFilter = document.getElementById('porteFilter').value;

            let filteredEmpresas = empresas.filter(empresa => {
                return (periodoFilter === 'todos' || empresa.anoFundacao.toString() === periodoFilter) &&
                    (setorFilter === 'todos' || empresa.setor === setorFilter) &&
                    (porteFilter === 'todos' || empresa.porte === porteFilter);
            });

            if (filteredEmpresas.length === 0) {
                document.querySelector('.charts-container').innerHTML = `
            <div class="no-data" style="grid-column: 1 / -1;">
                <i class="fas fa-chart-bar" style="font-size: 48px; color: #ccc; margin-bottom: 20px;"></i>
                <p>Nenhum dado disponível para os filtros selecionados.</p>
            </div>
        `;
                return;
            }

            createFaturamentoChart(filteredEmpresas);
            createSetorChart(filteredEmpresas);
            createScatterChart(filteredEmpresas);
            createLineChart(filteredEmpresas);
        }

        // Gráfico de faturamento por empresa
        function createFaturamentoChart(data) {
            const ctx = document.getElementById('faturamentoChart').getContext('2d');

            if (charts.faturamento) {
                charts.faturamento.destroy();
            }

            const chartData = data.slice(0, 10).map(e => ({
                x: e.nome.length > 15 ? e.nome.substring(0, 15) + '...' : e.nome,
                y: e.faturamento
            }));

            charts.faturamento = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(d => d.x),
                    datasets: [{
                        label: 'Faturamento Mensal (R$)',
                        data: chartData.map(d => d.y),
                        backgroundColor: 'rgba(234, 130, 11, 0.8)',
                        borderColor: 'rgba(234, 130, 11, 1)',
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function (value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        // Gráfico de distribuição por setor
        function createSetorChart(data) {
            const ctx = document.getElementById('setorChart').getContext('2d');

            if (charts.setor) {
                charts.setor.destroy();
            }

            const setorData = {};
            data.forEach(e => {
                setorData[e.setor] = (setorData[e.setor] || 0) + 1;
            });

            const colors = [
                '#ea820b', '#ff9533', '#667eea', '#764ba2',
                '#f093fb', '#f5576c', '#4facfe', '#00f2fe'
            ];

            charts.setor = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(setorData),
                    datasets: [{
                        data: Object.values(setorData),
                        backgroundColor: colors,
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        // Gráfico de dispersão funcionários vs faturamento
        function createScatterChart(data) {
            const ctx = document.getElementById('scatterChart').getContext('2d');

            if (charts.scatter) {
                charts.scatter.destroy();
            }

            const chartData = data.map(e => ({
                x: e.funcionarios,
                y: e.faturamento,
                label: e.nome
            }));

            charts.scatter = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Funcionários vs Faturamento',
                        data: chartData,
                        backgroundColor: 'rgba(234, 130, 11, 0.6)',
                        borderColor: 'rgba(234, 130, 11, 1)',
                        borderWidth: 2,
                        pointRadius: 8,
                        pointHoverRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function (context) {
                                    return chartData[context[0].dataIndex].label;
                                },
                                label: function (context) {
                                    return [
                                        `Funcionários: ${context.parsed.x}`,
                                        `Faturamento: R$ ${context.parsed.y.toLocaleString('pt-BR')}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Número de Funcionários'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Faturamento Mensal (R$)'
                            },
                            ticks: {
                                callback: function (value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Gráfico de linha temporal
        function createLineChart(data) {
            const ctx = document.getElementById('lineChart').getContext('2d');

            if (charts.line) {
                charts.line.destroy();
            }

            // Agrupar por ano de fundação
            const anoData = {};
            data.forEach(e => {
                const ano = e.anoFundacao;
                if (!anoData[ano]) {
                    anoData[ano] = { count: 0, faturamento: 0 };
                }
                anoData[ano].count++;
                anoData[ano].faturamento += e.faturamento;
            });

            const anos = Object.keys(anoData).sort();
            const counts = anos.map(ano => anoData[ano].count);
            const faturamentos = anos.map(ano => anoData[ano].faturamento);

            charts.line = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: anos,
                    datasets: [{
                        label: 'Empresas Fundadas',
                        data: counts,
                        borderColor: 'rgba(234, 130, 11, 1)',
                        backgroundColor: 'rgba(234, 130, 11, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        yAxisID: 'y'
                    }, {
                        label: 'Faturamento Total',
                        data: faturamentos,
                        borderColor: 'rgba(102, 126, 234, 1)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Ano de Fundação'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Número de Empresas'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Faturamento (R$)'
                            },
                            ticks: {
                                callback: function (value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // Fechar modal clicando fora
        window.onclick = function (event) {
            const modal = document.getElementById('companyModal');
            if (event.target === modal) {
                closeModal();
            }
        };

        // Aplicar filtros
        document.getElementById('periodoFilter').addEventListener('change', updateCharts);
        document.getElementById('setorFilter').addEventListener('change', updateCharts);
        document.getElementById('porteFilter').addEventListener('change', updateCharts);

        // Dados de exemplo para demonstração
        function loadSampleData() {
            const sampleEmpresas = [
                {
                    id: 1,
                    nome: "TechSolutions Ltda",
                    cnpj: "12.345.678/0001-90",
                    setor: "Tecnologia",
                    porte: "medio",
                    faturamento: 150000,
                    funcionarios: 85,
                    cidade: "São Paulo",
                    estado: "SP",
                    anoFundacao: 2018,
                    ticketMedio: 2500,
                    email: "contato@techsolutions.com.br",
                    observacoes: "Empresa de desenvolvimento de software",
                    dataCadastro: new Date().toISOString()
                },
                {
                    id: 2,
                    nome: "Varejo Premium",
                    cnpj: "23.456.789/0001-01",
                    setor: "Varejo",
                    porte: "grande",
                    faturamento: 350000,
                    funcionarios: 250,
                    cidade: "Rio de Janeiro",
                    estado: "RJ",
                    anoFundacao: 2015,
                    ticketMedio: 180,
                    email: "contato@varejopr.com.br",
                    observacoes: "Rede de lojas de produtos premium",
                    dataCadastro: new Date().toISOString()
                },
                {
                    id: 3,
                    nome: "Indústria Inovadora",
                    cnpj: "34.567.890/0001-12",
                    setor: "Indústria",
                    porte: "grande",
                    faturamento: 500000,
                    funcionarios: 320,
                    cidade: "Belo Horizonte",
                    estado: "MG",
                    anoFundacao: 2010,
                    ticketMedio: 8500,
                    email: "contato@industriaino.com.br",
                    observacoes: "Indústria de componentes eletrônicos",
                    dataCadastro: new Date().toISOString()
                },
                {
                    id: 4,
                    nome: "Consultoria Estratégica",
                    cnpj: "45.678.901/0001-23",
                    setor: "Serviços",
                    porte: "pequeno",
                    faturamento: 80000,
                    funcionarios: 25,
                    cidade: "Porto Alegre",
                    estado: "RS",
                    anoFundacao: 2020,
                    ticketMedio: 5000,
                    email: "contato@consultoria.com.br",
                    observacoes: "Consultoria em gestão empresarial",
                    dataCadastro: new Date().toISOString()
                },
                {
                    id: 5,
                    nome: "Clínica Saúde Total",
                    cnpj: "56.789.012/0001-34",
                    setor: "Saúde",
                    porte: "medio",
                    faturamento: 220000,
                    funcionarios: 120,
                    cidade: "Curitiba",
                    estado: "PR",
                    anoFundacao: 2016,
                    ticketMedio: 350,
                    email: "contato@saudetotal.com.br",
                    observacoes: "Clínica médica multiespecializada",
                    dataCadastro: new Date().toISOString()
                }
            ];

            empresas = sampleEmpresas;
            displayCompanies();
            updateDashboard();
        }

        // Inicializar com dados de exemplo
        loadSampleData();

        // Inicializar dashboard
        updateDashboard();

    </script>
</body>

</html>
